<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Portada del Juego</title>
    <link rel="stylesheet" href="css/index.css" />
    <title>Redirigiendo...</title>
    <script>
      if (!sessionStorage.getItem("splashShown")) {
        sessionStorage.setItem("splashShown", "true");
        window.location.href = "splash.html";
      }
    </script>
  </head>
  <body>
    <!-- Audio de fondo -->
    <audio id="indexMusic" autoplay loop>
      <source src="audio/musicaIntro.mp3" type="audio/mpeg" />
    </audio>

    <!-- Capa oscura -->
    <div class="dark-overlay" id="darkOverlay"></div>
    <!-- Botón fijo para salir del juego -->

    <div class="container" id="startScreen">
      <img
        src="img/nombre.png"
        alt="Logo del juego Mono Aventurero"
        width="500"
        height="300"
        class="image-background"
      />
      <h1>---</h1>
      <button id="startButton">Iniciar Juego</button>
      <button onclick="openInstructions()">¿Como Jugar?</button>
    </div>

    <!-- Modal de selección de nivel -->
    <div id="levelModal">
      <h2>Selecciona un Nivel</h2>
      <button id="closeLevelModalButton">❌</button>
      <div id="comingSoonText">Próximamente</div>

      <div class="level-container">
        <!-- Niveles 1 a 9 -->
        <button class="nivel-boton" id="level1" onclick="startGame(1)">
          Nivel 1
        </button>
        <button class="nivel-boton" id="level2" onclick="startGame(2)">
          Nivel 2
        </button>
        <button class="nivel-boton" id="level3" onclick="startGame(3)">
          Nivel 3
        </button>
        <button class="nivel-boton" id="level4" onclick="startGame(4)">
          Nivel 4
        </button>
        <button class="nivel-boton" id="level5" onclick="startGame(5)">
          Nivel 5
        </button>
        <button class="nivel-boton" id="level6" onclick="startGame(6)">
          Nivel 6
        </button>
        <button class="nivel-boton" id="level7" onclick="startGame(7)">
          Nivel 7
        </button>
        <button class="nivel-boton" id="level8" onclick="startGame(8)">
          Nivel 8
        </button>
        <button class="nivel-boton" id="level9" onclick="startGame(9)">
          Nivel 9
        </button>
        <!-- Niveles 10 a 18 (próximamente) -->

        <button class="nivel-boton" id="level10">Nivel 10</button>
        <button class="nivel-boton" id="level11">Nivel 11</button>
        <button class="nivel-boton" id="level12">Nivel 12</button>
        <button class="nivel-boton" id="level13">Nivel 13</button>
        <button class="nivel-boton" id="level14">Nivel 14</button>
        <button class="nivel-boton" id="level15">Nivel 15</button>
        <button class="nivel-boton" id="level16">Nivel 16</button>
        <button class="nivel-boton" id="level17">Nivel 17</button>
        <button class="nivel-boton" id="level18">Nivel 18</button>
      </div>
      <div class="level-pagination">
        <button id="prevPage" class="hidden">←</button>
        <button id="nextPage">→</button>
      </div>
    </div>

    <!-- Modal 2 -->
    <div id="newModal2">
      <h2>Instrucciones del Juego</h2>
      <p>¡Prepárate para una gran aventura en tu móvil o tablet!</p>

      <h3>Objetivo</h3>
      <p>
        Esquiva obstáculos, derrota enemigos y recoge objetos especiales para
        avanzar de nivel. ¡Tu misión es llegar lo más lejos posible!
      </p>

      <h3>Cómo jugar</h3>
      <p>
        Solo necesitas tus dedos. Usa los botones táctiles que aparecen en
        pantalla:
      </p>
      <ul>
        <li><strong>Izquierda / Derecha:</strong> Mueve al personaje.</li>
        <li>
          <strong>Saltar:</strong> Toca el botón de salto (puedes saltar dos
          veces seguidas).
        </li>
        <li>
          <strong>Disparo:</strong> Usa el botón de disparo para eliminar
          enemigos.
        </li>
        <li>
          <strong>Escudo:</strong> Usa el botón de escudo para protegerte de los
          masivos ataques.
        </li>
        <li>
          <strong>Pausa:</strong> Toca el botón rojo de pausa arriba a la
          derecha.
        </li>
      </ul>

      <h3>Avance y mejoras</h3>
      <p>
        A medida que avanzas, los niveles se hacen más difíciles. Encontrarás:
      </p>
      <ul>
        <li>
          <strong>Power-ups:</strong> Aumentan tu velocidad o te dan escudo.
        </li>
        <li><strong>Plátanos:</strong> Suma puntos al recogerlos.</li>
        <li><strong>Corazones:</strong> Recupera vidas.</li>
      </ul>

      <h3>Consejos útiles</h3>
      <ul>
        <li>
          Activa el escudo solo cuando lo necesites: tiene tiempo de recarga.
        </li>
        <li>
          Evita los meteoritos y proyectiles del jefe. ¡Algunos vienen por
          sorpresa!
        </li>
        <li>En niveles más altos hay checkpoints (puntos de guardado).</li>
      </ul>

      <h3>¡Cuidado!</h3>
      <p>
        Si tocas un enemigo o recibes varios impactos, perderás vidas. Si se
        acaban, tendrás que reiniciar desde el principio o desde un checkpoint
        (en los niveles avanzados).
      </p>

      <p>¡Buena suerte, y toca la pantalla con precisión!</p>

      <button onclick="closeInstructions()">Cerrar</button>
    </div>

    <!-- Modal de Créditos -->
    <div id="creditsModal" class="credits-modal">
      <div class="credits-container">
        <div class="credits-content">
          <p>MONKEY´S PARADISE</p>
          <p>Desarrollado por: Iker Domínguez Calcerrada</p>
          <p>Historia y Diseño: Iker Domínguez Calcerrada</p>
          <p>Asignatura: Entorno cliente (Js)</p>
          <p>Agradecimientos especiales a:</p>
          <p>- Fernando Camacho</p>
          <p>- Alejandro Herrera</p>
          <p>- Adrian Vaquero</p>
          <p>Música de Niveles:</p>
          <p>
            - "La mejor MUSICA 8 BITS SIN COPYRIGHT para tus intros #1" - El
            Pixel
          </p>
          <p>
            - "Jeremy Blake - Powerup! ♫ NO COPYRIGHT 8-bit Music" - Free Music
          </p>
          <p>
            - "Kevin MacLeod - Itty Bitty 8 Bit ♫ NO COPYRIGHT 8-bit Music" -
            Free Music
          </p>
          <p>
            - "Giorno's Theme but it's ULTRA EPIC VERSION (Gold Experience
            Requiem)" - Samuel Kim Music (Nivel 9)
          </p>
          <p>Música de Bosses:</p>
          <p>- "Until it is done" - Oyff</p>
          <p>- "Goblin Slayer Main OST (Ogre Fight Theme)" - AnoKira Senpai</p>
          <p>
            - "One Punch Man Season 2 OST - I'm A Monster (Garou theme)" - Epic
            Play
          </p>
          <p>
            - "Dragon Castle" by @Makai-symphony - BreakingCopyright (Boss 6)
          </p>
          <p>Música de Introducción:</p>
          <p>
            - "ROYALTY FREE Tribal Jungle Nature Africa Ethnic Instrumental
            Background Music For Videos" - Eitan Epstein Music
          </p>
          <p>¡Gracias por jugar!</p>
          <p>© 2025 Monkey´s Paradise - Todos los derechos reservados</p>
        </div>
      </div>
    </div>
    <!-- Modal de Confirmación para Salir -->

    <div id="toastMessage" style="display: none"></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (window.Capacitor && Capacitor.getPlatform() !== "web") {
          console.log("✅ Capacitor nativo detectado");

          const App = Capacitor.Plugins.App;
          const modal = document.getElementById("exitModal");
          const btnConfirm = document.getElementById("confirmExit");
          const btnCancel = document.getElementById("cancelExit");
          const btnExit = document.getElementById("fixedExitButton");

          let lastBackPress = 0;

          App.addListener("backButton", ({ canGoBack }) => {
            const now = Date.now();
            if (!canGoBack) {
              if (now - lastBackPress < 2000) {
                App.exitApp();
              } else {
                showToast("Pulsa otra vez para salir");
                lastBackPress = now;
              }
            }
          });

          btnConfirm.addEventListener("click", () => {
            App.exitApp();
          });

          btnCancel.addEventListener("click", () => {
            modal.style.display = "none";
          });

          btnExit.addEventListener("click", () => {
            modal.style.display = "flex";
          });
        } else {
          console.warn(
            "⚠️ No se detectó entorno nativo o Capacitor no disponible"
          );
        }
      });

      function showToast(message) {
        let toast = document.getElementById("toastMessage");
        toast.textContent = message;
        toast.style.position = "fixed";
        toast.style.bottom = "60px";
        toast.style.left = "50%";
        toast.style.transform = "translateX(-50%)";
        toast.style.background = "rgba(0, 0, 0, 0.85)";
        toast.style.color = "#fff";
        toast.style.padding = "10px 20px";
        toast.style.borderRadius = "8px";
        toast.style.fontFamily = "Press Start 2P, cursive";
        toast.style.zIndex = "99999";
        toast.style.border = "2px solid red";
        toast.style.display = "block";

        clearTimeout(window.toastTimeout);
        window.toastTimeout = setTimeout(() => {
          toast.style.display = "none";
        }, 2000);
      }
    </script>

    <script src="script/index.js"></script>
  </body>
</html>
